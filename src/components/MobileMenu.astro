---
import { buttonVariants } from "@/components/ui/button";
---

<!-- Mobile Menu Component - This includes the toggle button and slide-out menu -->
<div class="md:hidden">
  <!-- Mobile Menu Toggle Button -->
  <button
    id="mobile-menu-toggle"
    class="p-2 rounded-md hover:bg-muted/50 transition-colors duration-200"
    aria-label="Toggle mobile menu"
  >
    <!-- Hamburger Icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      id="hamburger-icon"
    >
      <line x1="4" y1="6" x2="20" y2="6"></line>
      <line x1="4" y1="12" x2="20" y2="12"></line>
      <line x1="4" y1="18" x2="20" y2="18"></line>
    </svg>

    <!-- Close Icon -->
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="hidden"
      id="close-icon"
    >
      <line x1="18" y1="6" x2="6" y2="18"></line>
      <line x1="6" y1="6" x2="18" y2="18"></line>
    </svg>
  </button>

  <!-- Mobile Menu Panel - this will slide out from under the header -->
  <div
    id="mobile-menu"
    class="fixed left-0 top-16 w-full md:hidden h-[calc(100vh-4rem)] bg-background shadow-md z-40 border-t border-border -translate-y-full transition-all duration-300 ease-in-out"
  >
    <div class="container mx-auto px-4 sm:px-6 py-6 flex flex-col h-full">
      <nav class="space-y-4">
        <a href="#services" class="block text-xl py-3 border-b border-border hover:text-primary transition-colors">
          Services
        </a>
        <a href="#why-different" class="block text-xl py-3 border-b border-border hover:text-primary transition-colors">
          Why We're Different
        </a>
        <a href="#pricing" class="block text-xl py-3 border-b border-border hover:text-primary transition-colors">
          Pricing
        </a>
        
        <div class="pt-6 space-y-4">
          <button id="mobile-audit-btn" class={buttonVariants({ variant: 'default', size: 'lg', class: "w-full" })}>
            Get Free Audit
          </button>
          <a href="https://nxtmt.bloom.io/login" target="_blank" rel="noopener noreferrer" class="block">
            <button class={buttonVariants({ variant: 'outline', size: 'lg', class: "w-full" })}>
              Login
            </button>
          </a>
        </div>
      </nav>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const menuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerIcon = document.getElementById('hamburger-icon');
  const closeIcon = document.getElementById('close-icon');
  const auditBtn = document.getElementById('mobile-audit-btn');
  const mobileLinks = document.querySelectorAll('#mobile-menu a');
  
  // Enhanced debug logging
  console.log('%c Mobile Menu Debug', 'background: #333; color: #ff9800; padding: 4px; border-radius: 4px;');
  console.log('Mobile menu elements found:', {
    menuToggle: !!menuToggle,
    mobileMenu: !!mobileMenu,
    hamburgerIcon: !!hamburgerIcon,
    closeIcon: !!closeIcon
  });
  
  // Check initial CSS classes on mobile menu
  if (mobileMenu) {
    console.log('Initial mobile menu classes:', mobileMenu.className);
    console.log('Menu position:', {
      top: mobileMenu.style.top,
      transform: mobileMenu.style.transform,
      height: mobileMenu.style.height
    });
  }
  
  // Function to toggle the mobile menu
  function toggleMenu() {
    if (!mobileMenu || !hamburgerIcon || !closeIcon) {
      console.error('Mobile menu elements not found');
      return;
    }
    
    const isOpen = mobileMenu.classList.contains('translate-y-0');
    console.log('Toggling menu. Currently open:', isOpen);
    
    // For smoother animation, use requestAnimationFrame
    requestAnimationFrame(() => {
      if (isOpen) {
        // Close menu - first hide visually with CSS
        mobileMenu.classList.remove('translate-y-0'); 
        mobileMenu.classList.add('-translate-y-full');
        
        // Then update the UI elements
        requestAnimationFrame(() => {
          hamburgerIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        });
        
        console.log('Menu closed');
      } else {
        // Open menu - ensure we show menu first
        mobileMenu.classList.remove('-translate-y-full');
        mobileMenu.classList.add('translate-y-0');
        
        // Then update UI elements
        requestAnimationFrame(() => {
          hamburgerIcon.classList.add('hidden');
          closeIcon.classList.remove('hidden');
          document.body.classList.add('overflow-hidden');
        });
        
        console.log('Menu opened');
      }
    });
  }
  
  // Toggle menu when the button is clicked
  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener('click', (e) => {
      e.preventDefault();
      console.log('%c Menu toggle clicked', 'background: #333; color: #4CAF50; padding: 4px; border-radius: 4px;');
      
      // Force repaint before toggle (sometimes helps with animation glitches)
      void mobileMenu.offsetHeight;
      
      toggleMenu();
      
      // Log after toggle
      setTimeout(() => {
        console.log('Menu classes after toggle:', mobileMenu.className);
      }, 50);
    });
  }
  
  // Close menu when links are clicked
  if (mobileMenu) {
    mobileLinks.forEach(link => {
      link.addEventListener('click', toggleMenu);
    });
  }
  
  // Handle the audit button
  if (auditBtn && mobileMenu && hamburgerIcon && closeIcon) {
    auditBtn.addEventListener('click', (e) => {
      e.preventDefault();
      console.log('Audit button clicked - closing menu');
      
      // Close the mobile menu - force close regardless of state
      requestAnimationFrame(() => {
        mobileMenu.classList.remove('translate-y-0');
        mobileMenu.classList.add('-translate-y-full');
        
        requestAnimationFrame(() => {
          hamburgerIcon.classList.remove('hidden');
          closeIcon.classList.add('hidden');
          document.body.classList.remove('overflow-hidden');
        });
      });
      
      // Get the header height for offset
      const headerHeight = document.querySelector('header')?.offsetHeight || 64;
      const targetElement = document.getElementById('site-audit-section');
      
      if (targetElement) {
        const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
        
        // Scroll to the element with the header offset
        window.scrollTo({
          top: elementPosition - headerHeight - 20,
          behavior: 'smooth'
        });
      }
    });
  }
});
</script>