---
import { buttonVariants } from "@/components/ui/button";
import { Menu } from 'lucide-react';
---

<!-- Mobile Menu Toggle Button with Icon -->
<button
  id="mobile-menu-toggle"
  class="md:hidden p-2 rounded-md bg-primary text-white font-bold z-50 flex items-center gap-2"
  aria-label="Toggle mobile menu"
>
  <span>Menu</span>
  <Menu className="w-5 h-5" />
</button>

<!-- Mobile Menu Panel -->
<div
  id="mobile-menu"
  class="fixed left-0 top-16 w-full md:hidden h-[calc(100vh-4rem)] bg-background shadow-md z-40 border-t border-border -translate-y-full transition-transform duration-300"
  style="transform: translateY(-100%);"
>
  <div class="container mx-auto px-4 sm:px-6 py-6 flex flex-col h-full">
    <nav class="space-y-4">
      <a href="#services" class="block text-xl py-3 border-b border-border hover:text-primary transition-colors">
        Services
      </a>
      <a href="#why-different" class="block text-xl py-3 border-b border-border hover:text-primary transition-colors">
        Why We're Different
      </a>
      <a href="#pricing" class="block text-xl py-3 border-b border-border hover:text-primary transition-colors">
        Pricing
      </a>
      
      <div class="pt-6 space-y-4">
        <button id="mobile-audit-btn" class={buttonVariants({ variant: 'default', size: 'lg', class: "w-full" })}>
          Get Free Audit
        </button>
        <a href="https://nxtmt.bloom.io/login" target="_blank" rel="noopener noreferrer" class="block">
          <button class={buttonVariants({ variant: 'outline', size: 'lg', class: "w-full" })}>
            Login
          </button>
        </a>
      </div>
    </nav>
  </div>
</div>

<script is:inline>
document.addEventListener('DOMContentLoaded', () => {
  const menuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const auditBtn = document.getElementById('mobile-audit-btn');
  const mobileLinks = document.querySelectorAll('#mobile-menu a');
  
  // Debug logs
  console.log('Menu Toggle Button:', menuToggle);
  console.log('Mobile Menu Panel:', mobileMenu);
  
  // Function to toggle the mobile menu
  function toggleMenu() {
    if (!mobileMenu || !menuToggle) {
      console.error('Mobile menu or toggle button not found');
      return;
    }
    
    console.log('Toggling mobile menu');
    
    const isOpen = mobileMenu.style.transform === 'translateY(0%)';
    
    if (isOpen) {
      // Close menu
      mobileMenu.style.transform = 'translateY(-100%)';
      menuToggle.querySelector('span').textContent = 'Menu';
      document.body.classList.remove('overflow-hidden');
      console.log('Menu closed');
    } else {
      // Open menu
      mobileMenu.style.transform = 'translateY(0%)';
      menuToggle.querySelector('span').textContent = 'Close';
      document.body.classList.add('overflow-hidden');
      console.log('Menu opened');
    }
  }
  
  // Toggle menu when the button is clicked
  if (menuToggle) {
    console.log('Adding click event to menu toggle');
    menuToggle.addEventListener('click', (e) => {
      console.log('Menu toggle clicked');
      e.preventDefault();
      e.stopPropagation();
      toggleMenu();
    });
  } else {
    console.error('Menu toggle button not found');
  }
  
  // Close menu when links are clicked
  if (mobileMenu) {
    mobileLinks.forEach(link => {
      link.addEventListener('click', toggleMenu);
    });
  }
  
  // Handle the audit button
  if (auditBtn) {
    auditBtn.addEventListener('click', (e) => {
      console.log('Audit button clicked');
      e.preventDefault();
      
      // Close the mobile menu
      if (mobileMenu && menuToggle) {
        mobileMenu.style.transform = 'translateY(-100%)';
        menuToggle.querySelector('span').textContent = 'Menu';
        document.body.classList.remove('overflow-hidden');
      }
      
      // Get the header height for offset
      const headerHeight = document.querySelector('header')?.offsetHeight || 64;
      const targetElement = document.getElementById('site-audit-section');
      
      if (targetElement) {
        const elementPosition = targetElement.getBoundingClientRect().top + window.pageYOffset;
        
        // Scroll to the element with the header offset
        window.scrollTo({
          top: elementPosition - headerHeight - 20,
          behavior: 'smooth'
        });
      }
    });
  }
});
</script>