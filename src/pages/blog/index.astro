---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Calendar, ArrowRight, Newspaper } from "lucide-react";
import { getSearchSerpaPosts, getFallbackPosts, formatDate, stripHtml } from "@/lib/wordpress";
import type { WpPost } from "@/lib/wordpress";

// Fetch posts from WordPress API or use fallbacks
let posts: WpPost[] = [];

try {
  // Try to get posts from the SearchSerpa category
  posts = await getSearchSerpaPosts({ perPage: 9 });
  
  // If no posts were found, use fallback posts
  if (posts.length === 0) {
    posts = getFallbackPosts();
  }
} catch (error) {
  console.error('Error fetching blog posts:', error);
  // Use fallback posts if there was an error
  posts = getFallbackPosts();
}
---

<BaseLayout 
  title="SearchSerpa Blog | SEO Tips & Strategies"
  description="Discover the latest insights, strategies, and best practices for SEO, content marketing, and online visibility from the SearchSerpa team."
>
  <section class="py-12 md:py-16 lg:py-20">
    <div class="container mx-auto px-4 sm:px-6">
      <div class="text-center max-w-3xl mx-auto mb-16">
        <div class="inline-flex items-center justify-center bg-primary/10 px-4 py-1.5 rounded-full text-primary font-medium text-sm mb-4">
          <Newspaper className="h-4 w-4 mr-2" />
          <span>SearchSerpa Blog</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-6">
          SEO Knowledge & <span class="text-primary">Insights</span>
        </h1>
        <p class="text-xl text-muted-foreground">
          Expert guidance to help your business climb to the top of search results
        </p>
      </div>

      <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
        {posts.map(post => (
          <a href={`/blog/${post.slug}`} class="group">
            <Card class="h-full flex flex-col transition-shadow duration-300 hover:shadow-lg">
              <div class="aspect-video w-full overflow-hidden rounded-t-lg">
                <img
                  src={post._embedded?.['wp:featuredmedia']?.[0]?.source_url || post.featuredImage}
                  alt={post._embedded?.['wp:featuredmedia']?.[0]?.alt_text || (typeof post.title === 'string' ? post.title : stripHtml(post.title?.rendered || ''))}
                  class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
                />
              </div>
              <CardHeader class="pb-2 pt-4">
                <CardTitle class="line-clamp-2 text-xl group-hover:text-primary transition-colors duration-300">
                  {post.title?.rendered ? <Fragment set:html={post.title.rendered} /> : post.title}
                </CardTitle>
              </CardHeader>
              <CardContent class="flex-grow">
                <p class="line-clamp-3 text-muted-foreground">
                  {post.excerpt?.rendered ? stripHtml(post.excerpt.rendered) : post.excerpt}
                </p>
              </CardContent>
              <CardFooter class="border-t pt-4 flex justify-between items-center">
                <div class="flex items-center text-sm text-muted-foreground">
                  <Calendar className="h-3 w-3 mr-1" />
                  <span>{formatDate(post.date)}</span>
                </div>
                <div class="text-sm text-primary font-medium inline-flex items-center group-hover:underline">
                  Read Article <ArrowRight className="ml-1 h-3 w-3 group-hover:translate-x-0.5 transition-transform" />
                </div>
              </CardFooter>
            </Card>
          </a>
        ))}
      </div>
    </div>
  </section>
</BaseLayout>