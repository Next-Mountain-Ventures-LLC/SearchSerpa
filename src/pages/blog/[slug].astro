---
import BlogPostLayout from "@/layouts/BlogPostLayout.astro";
import { getPostBySlug, getSearchSerpaPosts, getFallbackPosts } from "@/lib/wordpress";

export async function getStaticPaths() {
  let posts = [];
  
  try {
    posts = await getSearchSerpaPosts({ perPage: 100 });
  } catch (error) {
    console.error("Error fetching posts from API:", error);
  }
  
  // Fallback to sample posts if API request fails
  if (posts.length === 0) {
    console.log("Using fallback posts");
    posts = getFallbackPosts();
  }
  
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// Handle case where post might not have been found
if (!post) {
  return Astro.redirect("/404");
}
---

<BlogPostLayout post={post} />